<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Applied Machine Learning for Educational Data Science: Bagged Trees and Random Forests</title>


  <link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>

  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-11-23"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-11-23"/>
  <meta name="article:author" content="Cengiz Zopluoglu"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Applied Machine Learning for Educational Data Science: Bagged Trees and Random Forests"/>
  <meta property="og:type" content="article"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:site_name" content="Applied Machine Learning for Educational Data Science"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Applied Machine Learning for Educational Data Science: Bagged Trees and Random Forests"/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","author","date","output"]}},"value":[{"type":"character","attributes":{},"value":["Bagged Trees and Random Forests"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","affiliation"]}},"value":[{"type":"character","attributes":{},"value":["Cengiz Zopluoglu"]},{"type":"character","attributes":{},"value":["University of Oregon"]}]}]},{"type":"character","attributes":{},"value":["11/23/2022"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_float","theme"]}},"value":[{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["theme.css"]}]}]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  <!--radix_placeholder_navigation_in_header-->
  <meta name="distill:offset" content=""/>

  <script type="application/javascript">

    window.headroom_prevent_pin = false;

    window.document.addEventListener("DOMContentLoaded", function (event) {

      // initialize headroom for banner
      var header = $('header').get(0);
      var headerHeight = header.offsetHeight;
      var headroom = new Headroom(header, {
        tolerance: 5,
        onPin : function() {
          if (window.headroom_prevent_pin) {
            window.headroom_prevent_pin = false;
            headroom.unpin();
          }
        }
      });
      headroom.init();
      if(window.location.hash)
        headroom.unpin();
      $(header).addClass('headroom--transition');

      // offset scroll location for banner on hash change
      // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
      window.addEventListener("hashchange", function(event) {
        window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
      });

      // responsive menu
      $('.distill-site-header').each(function(i, val) {
        var topnav = $(this);
        var toggle = topnav.find('.nav-toggle');
        toggle.on('click', function() {
          topnav.toggleClass('responsive');
        });
      });

      // nav dropdowns
      $('.nav-dropbtn').click(function(e) {
        $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
        $(this).parent().siblings('.nav-dropdown')
           .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $("body").click(function(e){
        $('.nav-dropdown-content').removeClass('nav-dropdown-active');
      });
      $(".nav-dropdown").click(function(e){
        e.stopPropagation();
      });
    });
  </script>

  <style type="text/css">

  /* Theme (user-documented overrideables for nav appearance) */

  .distill-site-nav {
    color: rgba(255, 255, 255, 0.8);
    background-color: #0F2E3D;
    font-size: 15px;
    font-weight: 300;
  }

  .distill-site-nav a {
    color: inherit;
    text-decoration: none;
  }

  .distill-site-nav a:hover {
    color: white;
  }

  @media print {
    .distill-site-nav {
      display: none;
    }
  }

  .distill-site-header {

  }

  .distill-site-footer {

  }


  /* Site Header */

  .distill-site-header {
    width: 100%;
    box-sizing: border-box;
    z-index: 3;
  }

  .distill-site-header .nav-left {
    display: inline-block;
    margin-left: 8px;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header .nav-left {
      margin-left: 0;
    }
  }


  .distill-site-header .nav-right {
    float: right;
    margin-right: 8px;
  }

  .distill-site-header a,
  .distill-site-header .title {
    display: inline-block;
    text-align: center;
    padding: 14px 10px 14px 10px;
  }

  .distill-site-header .title {
    font-size: 18px;
    min-width: 150px;
  }

  .distill-site-header .logo {
    padding: 0;
  }

  .distill-site-header .logo img {
    display: none;
    max-height: 20px;
    width: auto;
    margin-bottom: -4px;
  }

  .distill-site-header .nav-image img {
    max-height: 18px;
    width: auto;
    display: inline-block;
    margin-bottom: -3px;
  }



  @media screen and (min-width: 1000px) {
    .distill-site-header .logo img {
      display: inline-block;
    }
    .distill-site-header .nav-left {
      margin-left: 20px;
    }
    .distill-site-header .nav-right {
      margin-right: 20px;
    }
    .distill-site-header .title {
      padding-left: 12px;
    }
  }


  .distill-site-header .nav-toggle {
    display: none;
  }

  .nav-dropdown {
    display: inline-block;
    position: relative;
  }

  .nav-dropdown .nav-dropbtn {
    border: none;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
  }

  .nav-dropdown-content {
    display: none;
    position: absolute;
    background-color: white;
    min-width: 200px;
    border: 1px solid rgba(0,0,0,0.15);
    border-radius: 4px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
    z-index: 1;
    margin-top: 2px;
    white-space: nowrap;
    padding-top: 4px;
    padding-bottom: 4px;
  }

  .nav-dropdown-content hr {
    margin-top: 4px;
    margin-bottom: 4px;
    border: none;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .nav-dropdown-active {
    display: block;
  }

  .nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
  }

  .nav-dropdown-content .nav-dropdown-header {
    display: block;
    padding: 5px 24px;
    padding-bottom: 0;
    text-transform: uppercase;
    font-size: 14px;
    color: #999999;
    white-space: nowrap;
  }

  .nav-dropdown:hover .nav-dropbtn {
    color: white;
  }

  .nav-dropdown-content a:hover {
    background-color: #ddd;
    color: black;
  }

  .nav-right .nav-dropdown-content {
    margin-left: -45%;
    right: 0;
  }

  @media screen and (max-width: 768px) {
    .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
    .distill-site-header a.nav-toggle {
      float: right;
      display: block;
    }
    .distill-site-header .title {
      margin-left: 0;
    }
    .distill-site-header .nav-right {
      margin-right: 0;
    }
    .distill-site-header {
      overflow: hidden;
    }
    .nav-right .nav-dropdown-content {
      margin-left: 0;
    }
  }


  @media screen and (max-width: 768px) {
    .distill-site-header.responsive {position: relative; min-height: 500px; }
    .distill-site-header.responsive a.nav-toggle {
      position: absolute;
      right: 0;
      top: 0;
    }
    .distill-site-header.responsive a,
    .distill-site-header.responsive .nav-dropdown {
      display: block;
      text-align: left;
    }
    .distill-site-header.responsive .nav-left,
    .distill-site-header.responsive .nav-right {
      width: 100%;
    }
    .distill-site-header.responsive .nav-dropdown {float: none;}
    .distill-site-header.responsive .nav-dropdown-content {position: relative;}
    .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
      display: block;
      width: 100%;
      text-align: left;
    }
  }

  /* Site Footer */

  .distill-site-footer {
    width: 100%;
    overflow: hidden;
    box-sizing: border-box;
    z-index: 3;
    margin-top: 30px;
    padding-top: 30px;
    padding-bottom: 30px;
    text-align: center;
  }

  /* Headroom */

  d-title {
    padding-top: 6rem;
  }

  @media print {
    d-title {
      padding-top: 4rem;
    }
  }

  .headroom {
    z-index: 1000;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
  }

  .headroom--transition {
    transition: all .4s ease-in-out;
  }

  .headroom--unpinned {
    top: -100px;
  }

  .headroom--pinned {
    top: 0;
  }

  /* adjust viewport for navbar height */
  /* helps vertically center bootstrap (non-distill) content */
  .min-vh-100 {
    min-height: calc(100vh - 100px) !important;
  }

  </style>

  <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
  <link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
  <script src="site_libs/headroom-0.9.4/headroom.min.js"></script>
  <script src="site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
  <script src="site_libs/fuse-6.4.1/fuse.min.js"></script>

  <script type="application/javascript">

  function getMeta(metaName) {
    var metas = document.getElementsByTagName('meta');
    for (let i = 0; i < metas.length; i++) {
      if (metas[i].getAttribute('name') === metaName) {
        return metas[i].getAttribute('content');
      }
    }
    return '';
  }

  function offsetURL(url) {
    var offset = getMeta('distill:offset');
    return offset ? offset + '/' + url : url;
  }

  function createFuseIndex() {

    // create fuse index
    var options = {
      keys: [
        { name: 'title', weight: 20 },
        { name: 'categories', weight: 15 },
        { name: 'description', weight: 10 },
        { name: 'contents', weight: 5 },
      ],
      ignoreLocation: true,
      threshold: 0
    };
    var fuse = new window.Fuse([], options);

    // fetch the main search.json
    return fetch(offsetURL('search.json'))
      .then(function(response) {
        if (response.status == 200) {
          return response.json().then(function(json) {
            // index main articles
            json.articles.forEach(function(article) {
              fuse.add(article);
            });
            // download collections and index their articles
            return Promise.all(json.collections.map(function(collection) {
              return fetch(offsetURL(collection)).then(function(response) {
                if (response.status === 200) {
                  return response.json().then(function(articles) {
                    articles.forEach(function(article) {
                      fuse.add(article);
                    });
                  })
                } else {
                  return Promise.reject(
                    new Error('Unexpected status from search index request: ' +
                              response.status)
                  );
                }
              });
            })).then(function() {
              return fuse;
            });
          });

        } else {
          return Promise.reject(
            new Error('Unexpected status from search index request: ' +
                        response.status)
          );
        }
      });
  }

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // get search element (bail if we don't have one)
    var searchEl = window.document.getElementById('distill-search');
    if (!searchEl)
      return;

    createFuseIndex()
      .then(function(fuse) {

        // make search box visible
        searchEl.classList.remove('hidden');

        // initialize autocomplete
        var options = {
          autoselect: true,
          hint: false,
          minLength: 2,
        };
        window.autocomplete(searchEl, options, [{
          source: function(query, callback) {
            const searchOptions = {
              isCaseSensitive: false,
              shouldSort: true,
              minMatchCharLength: 2,
              limit: 10,
            };
            var results = fuse.search(query, searchOptions);
            callback(results
              .map(function(result) { return result.item; })
            );
          },
          templates: {
            suggestion: function(suggestion) {
              var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
                ? `<img src="${offsetURL(suggestion.preview)}"</img>`
                : '';
              var html = `
                <div class="search-item">
                  <h3>${suggestion.title}</h3>
                  <div class="search-item-description">
                    ${suggestion.description || ''}
                  </div>
                  <div class="search-item-preview">
                    ${img}
                  </div>
                </div>
              `;
              return html;
            }
          }
        }]).on('autocomplete:selected', function(event, suggestion) {
          window.location.href = offsetURL(suggestion.path);
        });
        // remove inline display style on autocompleter (we want to
        // manage responsive display via css)
        $('.algolia-autocomplete').css("display", "");
      })
      .catch(function(error) {
        console.log(error);
      });

  });

  </script>

  <style type="text/css">

  .nav-search {
    font-size: x-small;
  }

  /* Algolioa Autocomplete */

  .algolia-autocomplete {
    display: inline-block;
    margin-left: 10px;
    vertical-align: sub;
    background-color: white;
    color: black;
    padding: 6px;
    padding-top: 8px;
    padding-bottom: 0;
    border-radius: 6px;
    border: 1px #0F2E3D solid;
    width: 180px;
  }


  @media screen and (max-width: 768px) {
    .distill-site-nav .algolia-autocomplete {
      display: none;
      visibility: hidden;
    }
    .distill-site-nav.responsive .algolia-autocomplete {
      display: inline-block;
      visibility: visible;
    }
    .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
      margin-left: 0;
      width: 400px;
      max-height: 400px;
    }
  }

  .algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
    width: 90%;
    outline: none;
    border: none;
  }

  .algolia-autocomplete .aa-hint {
    color: #999;
  }
  .algolia-autocomplete .aa-dropdown-menu {
    width: 550px;
    max-height: 70vh;
    overflow-x: visible;
    overflow-y: scroll;
    padding: 5px;
    margin-top: 3px;
    margin-left: -150px;
    background-color: #fff;
    border-radius: 5px;
    border: 1px solid #999;
    border-top: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
    cursor: pointer;
    padding: 5px 4px;
    border-bottom: 1px solid #eee;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
    border-bottom: none;
    margin-bottom: 2px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
    overflow: hidden;
    font-size: 0.8em;
    line-height: 1.4em;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
    font-size: 1rem;
    margin-block-start: 0;
    margin-block-end: 5px;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
    display: inline-block;
    overflow: hidden;
    height: 2.8em;
    width: 80%;
    margin-right: 4%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
    display: inline-block;
    width: 15%;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
    height: 3em;
    width: auto;
    display: none;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
    display: initial;
  }

  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
    background-color: #eee;
  }
  .algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
    font-weight: bold;
    font-style: normal;
  }

  </style>


  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
          var fn = $(this).children()[0]
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // fix footnotes in tables (#411)
      // replacing broken distill.pub feature
      $('table d-footnote').each(function() {
        // we replace internal showAtNode methode which is triggered when hovering a footnote
        this.hoverBox.showAtNode = function(node) {
          // ported from https://github.com/distillpub/template/pull/105/files
          calcOffset = function(elem) {
              let x = elem.offsetLeft;
              let y = elem.offsetTop;
              // Traverse upwards until an `absolute` element is found or `elem`
              // becomes null.
              while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                  x += elem.offsetLeft;
                  y += elem.offsetTop;
              }

              return { left: x, top: y };
          }
          // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
          const bbox = node.getBoundingClientRect();
          const offset = calcOffset(node);
          this.show([offset.left + bbox.width, offset.top + bbox.height]);
        }
      })

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      // ignore leaflet img layers (#106)
      figures = figures.filter(':not(img[class*="leaflet"])')
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */
  </style>
  <style type="text/css">
  /* base variables */

  /* Edit the CSS properties in this file to create a custom
     Distill theme. Only edit values in the right column
     for each row; values shown are the CSS defaults.
     To return any property to the default,
     you may set its value to: unset
     All rows must end with a semi-colon.                      */

  /* Optional: embed custom fonts here with `@import`          */
  /* This must remain at the top of this file.                 */



  html {
    /*-- Main font sizes --*/
    --title-size:      50px;
    --body-size:       1.06rem;
    --code-size:       14px;
    --aside-size:      12px;
    --fig-cap-size:    13px;
    /*-- Main font colors --*/
    --title-color:     #000000;
    --header-color:    rgba(0, 0, 0, 0.8);
    --body-color:      rgba(0, 0, 0, 0.8);
    --aside-color:     rgba(0, 0, 0, 0.6);
    --fig-cap-color:   rgba(0, 0, 0, 0.6);
    /*-- Specify custom fonts ~~~ must be imported above   --*/
    --heading-font:    sans-serif;
    --mono-font:       monospace;
    --body-font:       sans-serif;
    --navbar-font:     sans-serif;  /* websites + blogs only */
  }

  /*-- ARTICLE METADATA --*/
  d-byline {
    --heading-size:    0.6rem;
    --heading-color:   rgba(0, 0, 0, 0.5);
    --body-size:       0.8rem;
    --body-color:      rgba(0, 0, 0, 0.8);
  }

  /*-- ARTICLE TABLE OF CONTENTS --*/
  .d-contents {
    --heading-size:    18px;
    --contents-size:   13px;
  }

  /*-- ARTICLE APPENDIX --*/
  d-appendix {
    --heading-size:    15px;
    --heading-color:   rgba(0, 0, 0, 0.65);
    --text-size:       0.8em;
    --text-color:      rgba(0, 0, 0, 0.5);
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  /* These properties only apply to Distill sites and blogs  */

  .distill-site-header {
    --title-size:       18px;
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  .distill-site-footer {
    --text-color:       rgba(255, 255, 255, 0.8);
    --text-size:        15px;
    --hover-color:      white;
    --bkgd-color:       #0F2E3D;
  }

  /*-- Additional custom styles --*/
  /* Add any additional CSS rules below                      */

  /* Code chunks */

  d-article pre { /* Chunk output */
    border-radius: 5px; /* Rounded edges */
    font-size: 12px;
    color: black;
    background-color: #c1daf0;
    padding: 5px 5px 5px 18px;
  }

  d-article div.sourceCode pre { /* Chunk code */
    border-radius: 5px; /* Rounded edges */
    background-color: #fff2cc;
    color: black;
    padding: 5px 5px 5px 18px;
  }

  d-article div.sourceCode {
    background-color: transparent;
  }</style>
  <style type="text/css">
  /* base style */

  /* FONT FAMILIES */

  :root {
    --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  body,
  .posts-list .post-preview p,
  .posts-list .description p {
    font-family: var(--body-font), var(--body-default);
  }

  h1, h2, h3, h4, h5, h6,
  .posts-list .post-preview h2,
  .posts-list .description h2 {
    font-family: var(--heading-font), var(--heading-default);
  }

  d-article div.sourceCode code,
  d-article pre code {
    font-family: var(--mono-font), var(--mono-default);
  }


  /*-- TITLE --*/
  d-title h1,
  .posts-list > h1 {
    color: var(--title-color, black);
  }

  d-title h1 {
    font-size: var(--title-size, 50px);
  }

  /*-- HEADERS --*/
  d-article h1,
  d-article h2,
  d-article h3,
  d-article h4,
  d-article h5,
  d-article h6 {
    color: var(--header-color, rgba(0, 0, 0, 0.8));
  }

  /*-- BODY --*/
  d-article > p,  /* only text inside of <p> tags */
  d-article > ul, /* lists */
  d-article > ol {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
    font-size: var(--body-size, 1.06rem);
  }


  /*-- CODE --*/
  d-article div.sourceCode code,
  d-article pre code {
    font-size: var(--code-size, 14px);
  }

  /*-- ASIDE --*/
  d-article aside {
    font-size: var(--aside-size, 12px);
    color: var(--aside-color, rgba(0, 0, 0, 0.6));
  }

  /*-- FIGURE CAPTIONS --*/
  figure .caption,
  figure figcaption,
  .figure .caption {
    font-size: var(--fig-cap-size, 13px);
    color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
  }

  /*-- METADATA --*/
  d-byline h3 {
    font-size: var(--heading-size, 0.6rem);
    color: var(--heading-color, rgba(0, 0, 0, 0.5));
  }

  d-byline {
    font-size: var(--body-size, 0.8rem);
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  d-byline a,
  d-article d-byline a {
    color: var(--body-color, rgba(0, 0, 0, 0.8));
  }

  /*-- TABLE OF CONTENTS --*/
  .d-contents nav h3 {
    font-size: var(--heading-size, 18px);
  }

  .d-contents nav a {
    font-size: var(--contents-size, 13px);
  }

  /*-- APPENDIX --*/
  d-appendix h3 {
    font-size: var(--heading-size, 15px);
    color: var(--heading-color, rgba(0, 0, 0, 0.65));
  }

  d-appendix {
    font-size: var(--text-size, 0.8em);
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  d-appendix d-footnote-list a.footnote-backlink {
    color: var(--text-color, rgba(0, 0, 0, 0.5));
  }

  /*-- WEBSITE HEADER + FOOTER --*/
  .distill-site-header .title {
    font-size: var(--title-size, 18px);
    font-family: var(--navbar-font), var(--heading-default);
  }

  .distill-site-header a,
  .nav-dropdown .nav-dropbtn {
    font-family: var(--navbar-font), var(--heading-default);
  }

  .nav-dropdown .nav-dropbtn {
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    font-size: var(--text-size, 15px);
  }

  .distill-site-header a:hover,
  .nav-dropdown:hover .nav-dropbtn {
    color: var(--hover-color, white);
  }

  .distill-site-header {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer {
    font-size: var(--text-size, 15px);
    color: var(--text-color, rgba(255, 255, 255, 0.8));
    background-color: var(--bkgd-color, #0F2E3D);
  }

  .distill-site-footer a:hover {
    color: var(--hover-color, white);
  }</style>
  <!--/radix_placeholder_distill-->
  <script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
  <script src="site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <script type="text/javascript" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=G-1RQZJC7E05"></script>
  <script type="text/javascript" cookie-consent="tracking">
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-1RQZJC7E05');
  </script>
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Bagged Trees and Random Forests","authors":[{"author":"Cengiz Zopluoglu","authorURL":"#","affiliation":"University of Oregon","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-11-23T00:00:00.000-08:00","citationText":"Zopluoglu, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a href="index.html" class="title">Applied Machine Learning for Educational Data Science</a>
</div>
<div class="nav-right">
<a href="index.html">Home</a>
<a href="syllabus.html">Syllabus</a>
<a href="schedule.html">Schedule</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Lecture Notes
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="lecture-1.html">Lecture-1</a>
<a href="lecture-2a.html">Lecture-2a</a>
<a href="lecture-2b.html">Lecture-2b</a>
<a href="lecture-3a.html">Lecture-3a</a>
<a href="lecture-3b.html">Lecture-3b</a>
<a href="lecture-4.html">Lecture-4</a>
<a href="lecture-5.html">Lecture-5</a>
<a href="lecture-6a.html">Lecture-6a</a>
<a href="lecture-6b.html">Lecture-6b</a>
<a href="lecture-7a.html">Lecture-7a</a>
<a href="lecture-7b.html">Lecture-7b</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Kaggle Notebooks
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="https://www.kaggle.com/code/uocoeeds/week-1-introduction/notebook">Notebook-1</a>
<a href="https://www.kaggle.com/code/uocoeeds/lecture-2a-data-preprocessing-i">Notebook-2a</a>
<a href="https://www.kaggle.com/code/uocoeeds/lecture-2b-data-preprocessing-ii">Notebook-2b</a>
<a href="https://www.kaggle.com/code/uocoeeds/the-recipes-package-demo">The {recipes} demo</a>
<a href="https://www.kaggle.com/code/uocoeeds/lecture-3a-overview-of-linear-regression">Notebook-3a</a>
<a href="https://www.kaggle.com/code/uocoeeds/lecture-3b-review-of-bias-variance-tradeoff">Notebook-3b</a>
<a href="https://www.kaggle.com/code/uocoeeds/building-a-prediction-model-with-cross-validation">Building Linear Models with `caret`</a>
<a href="https://www.kaggle.com/code/uocoeeds/lecture-4-regularized-penalized-regression">Notebook-4</a>
<a href="https://www.kaggle.com/code/uocoeeds/building-a-ridge-regression-model">Building a Ridge Regression Model</a>
<a href="https://www.kaggle.com/code/uocoeeds/building-a-lasso-regression-model">Building a Lasso Regression Model</a>
<a href="https://www.kaggle.com/code/uocoeeds/building-a-regression-model-with-elastic-net">Building an Elastic Net Model</a>
<a href="https://www.kaggle.com/code/uocoeeds/using-the-prediction-models-for-a-new-text">Using the Existing Models to Predict Outcome for New Observations</a>
<a href="https://www.kaggle.com/code/uocoeeds/building-a-logistic-regression-model/notebook">Building a Logistic Regression Model</a>
<a href="https://www.kaggle.com/code/uocoeeds/building-a-classification-model-with-ridge-penalty/">Building a Classification Model with Ridge Penalty</a>
<a href="https://www.kaggle.com/code/uocoeeds/building-a-classification-model-with-lasso-penalty">Building a Classification Model with Lasso Penalty</a>
<a href="https://www.kaggle.com/code/uocoeeds/building-a-classification-model-with-elastic-net">Building a Classification Model with Elastic Net</a>
<a href="https://www.kaggle.com/code/uocoeeds/building-a-prediction-model-using-knn">Building a Prediction Model with K-nearest neighbors</a>
<a href="https://www.kaggle.com/code/uocoeeds/building-a-classification-model-using-knn">Building a Classification Model with K-nearest neighbors</a>
<a href="https://www.kaggle.com/uocoeeds/building-a-prediction-model-using-a-decision-tree">Building a Prediction Model with a Decision Tree</a>
<a href="https://www.kaggle.com/code/uocoeeds/building-a-classification-tree-algorithm">Building a Classification Model with a Decision Tree</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Slides
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="slides/slide1.html">Week 1</a>
<a href="slides/slide2.html">Week 2</a>
<a href="slides/slide3.html">Week 3 &amp; 4</a>
<a href="slides/slide4.html">Week 5</a>
<a href="slides/slide5.html">Week 6 &amp; 7</a>
<a href="slides/slide6a.html">Week 8_Part 1</a>
<a href="slides/slide6b.html">Week 8_Part 2</a>
</div>
</div>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Assignments
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="https://www.kaggle.com/code/uocoeeds/assignment-1">Assignment1</a>
<a href="https://www.kaggle.com/code/uocoeeds/assignment-2">Assignment2</a>
<a href="https://www.kaggle.com/code/uocoeeds/assignment-3">Assignment3</a>
</div>
</div>
<a href="https://github.com/uo-datasci-specialization/c4-ml-fall-2022">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Bagged Trees and Random Forests</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->

</div>

<div class="d-byline">
  Cengiz Zopluoglu  (University of Oregon)
  
<br/>11/23/2022
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#the-concept-of-bootstrap-aggregation-bagging"
id="toc-the-concept-of-bootstrap-aggregation-bagging">1. The Concept of
Bootstrap Aggregation (BAGGING)</a>
<ul>
<li><a href="#bagging-do-it-yourself-with-the-rpart-package"
id="toc-bagging-do-it-yourself-with-the-rpart-package">1.1. BAGGING: Do
It Yourself with the <code>rpart</code> package</a></li>
<li><a href="#bagging-with-the-ranger-and-carettrain-packages"
id="toc-bagging-with-the-ranger-and-carettrain-packages">1.2. BAGGING
with the <code>ranger</code> and <code>caret::train()</code>
packages</a></li>
<li><a href="#tuning-the-number-of-tree-models-in-bagging"
id="toc-tuning-the-number-of-tree-models-in-bagging">1.3. Tuning the
Number of Tree Models in Bagging</a></li>
</ul></li>
<li><a href="#random-forests" id="toc-random-forests">2. Random
Forests</a></li>
<li><a
href="#predicting-recidivism-using-bagges-trees-and-random-forests"
id="toc-predicting-recidivism-using-bagges-trees-and-random-forests">3.
Predicting Recidivism using Bagges Trees and Random Forests</a>
<ul>
<li><a href="#bagged-trees" id="toc-bagged-trees">3.1. Bagged
Trees</a></li>
<li><a href="#random-forests-1" id="toc-random-forests-1">3.2. Random
Forests</a></li>
</ul></li>
</ul>
</nav>
</div>
<style>
.list-group-item.active, .list-group-item.active:focus, .list-group-item.active:hover {
    z-index: 2;
    color: #fff;
    background-color: #FC4445;
    border-color: #97CAEF;
}

#infobox {
  padding: 1em 1em 1em 4em;
  margin-bottom: 10px;
  border: 2px solid black;
  border-radius: 10px;
  background: #E6F6DC 5px center/3em no-repeat;
}

</style>
<p>[Updated: Sun, Nov 27, 2022 - 14:10:08 ]</p>
<h1 id="the-concept-of-bootstrap-aggregation-bagging">1. The Concept of
Bootstrap Aggregation (BAGGING)</h1>
<p>The concept of bagging is based on the idea that predictions from an
ensemble of models are better than any single model predictions. Suppose
we randomly draw multiple samples from a population and then develop a
prediction model for an outcome using each sample. The aggregated
predictions from these multiple models would perform better due to the
reduced model variance (aggregation would reduce noise due to
sampling).</p>
<p>Due to the lack of access to the population (even if we assume there
is a well-defined population), we can mimic the sampling from a
population by replacing it with <strong>bootstrapping</strong>. A
<strong>Bootstrap sample</strong> is a random sample with replacement
from the sample data.</p>
<p>Suppose there is sample data with ten observations and three
predictors. Below are five bootstrap samples from this sample data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>x1 <span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>20</span>,<span class='fl'>25</span>,<span class='fl'>30</span>,<span class='fl'>42</span>,<span class='fl'>10</span>,<span class='fl'>60</span>,<span class='fl'>65</span>,<span class='fl'>55</span>,<span class='fl'>80</span>,<span class='fl'>90</span><span class='op'>)</span>,</span>
<span>                x2 <span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>,<span class='fl'>15</span>,<span class='fl'>12</span>,<span class='fl'>20</span>,<span class='fl'>45</span>,<span class='fl'>75</span>,<span class='fl'>70</span>,<span class='fl'>80</span>,<span class='fl'>85</span>,<span class='fl'>90</span><span class='op'>)</span>,</span>
<span>                x3 <span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>25</span>,<span class='fl'>30</span>,<span class='fl'>35</span>,<span class='fl'>20</span>,<span class='fl'>40</span>,<span class='fl'>80</span>,<span class='fl'>85</span>,<span class='fl'>90</span>,<span class='fl'>92</span>,<span class='fl'>95</span><span class='op'>)</span>,</span>
<span>                label<span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'A'</span>,<span class='st'>'B'</span>,<span class='st'>'C'</span>,<span class='st'>'D'</span>,<span class='st'>'E'</span>,<span class='st'>'F'</span>,<span class='st'>'G'</span>,<span class='st'>'H'</span>,<span class='st'>'I'</span>,<span class='st'>'J'</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>d</span></span></code></pre>
</div>
<pre><code>   x1 x2 x3 label
1  20 10 25     A
2  25 15 30     B
3  30 12 35     C
4  42 20 20     D
5  10 45 40     E
6  60 75 80     F
7  65 70 85     G
8  55 80 90     H
9  80 85 92     I
10 90 90 95     J</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>11232022</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Bootstrap sample 1</span></span>
<span></span>
<span><span class='va'>d</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>,replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,<span class='op'>]</span></span></code></pre>
</div>
<pre><code>     x1 x2 x3 label
2    25 15 30     B
2.1  25 15 30     B
6    60 75 80     F
1    20 10 25     A
8    55 80 90     H
10   90 90 95     J
10.1 90 90 95     J
8.1  55 80 90     H
10.2 90 90 95     J
3    30 12 35     C</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Bootstrap sample 2</span></span>
<span></span>
<span><span class='va'>d</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>,replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,<span class='op'>]</span></span></code></pre>
</div>
<pre><code>     x1 x2 x3 label
4    42 20 20     D
9    80 85 92     I
9.1  80 85 92     I
10   90 90 95     J
6    60 75 80     F
10.1 90 90 95     J
3    30 12 35     C
2    25 15 30     B
9.2  80 85 92     I
4.1  42 20 20     D</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Bootstrap sample 3</span></span>
<span></span>
<span><span class='va'>d</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>,replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,<span class='op'>]</span></span></code></pre>
</div>
<pre><code>    x1 x2 x3 label
9   80 85 92     I
3   30 12 35     C
6   60 75 80     F
3.1 30 12 35     C
4   42 20 20     D
5   10 45 40     E
4.1 42 20 20     D
8   55 80 90     H
10  90 90 95     J
3.2 30 12 35     C</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Bootstrap sample 4</span></span>
<span></span>
<span><span class='va'>d</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>,replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,<span class='op'>]</span></span></code></pre>
</div>
<pre><code>     x1 x2 x3 label
8    55 80 90     H
7    65 70 85     G
3    30 12 35     C
1    20 10 25     A
10   90 90 95     J
2    25 15 30     B
9    80 85 92     I
10.1 90 90 95     J
6    60 75 80     F
10.2 90 90 95     J</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Bootstrap sample 5</span></span>
<span></span>
<span><span class='va'>d</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span>,replace <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>,<span class='op'>]</span></span></code></pre>
</div>
<pre><code>    x1 x2 x3 label
3   30 12 35     C
10  90 90 95     J
5   10 45 40     E
8   55 80 90     H
6   60 75 80     F
3.1 30 12 35     C
1   20 10 25     A
4   42 20 20     D
9   80 85 92     I
8.1 55 80 90     H</code></pre>
</div>
<p>The process of bagging is building separate models for each bootstrap
sample and then applying all these models to a new observation for
predicting the outcome. Finally, these predictions are aggregated in
some form (e.g., taking the average) to obtain a final prediction for
the new observation. The idea of bagging can technically be applied to
any prediction model (e.g., CNNs, regression models). During the model
process from each bootstrap sample, no regularization was applied, and
models were developed to their full complexity. So, we obtain so many
unbiased models. While each model has a significant sample variance, we
hope to reduce this sampling variance by aggregating the predictions
from all these models at the end.</p>
<p> </p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="figs/bagging.PNG" width="403" style="display: block; margin: auto;" /></p>
</div>
<h2 id="bagging-do-it-yourself-with-the-rpart-package">1.1. BAGGING: Do
It Yourself with the <code>rpart</code> package</h2>
<p>In this section, we will apply the bagging idea to decision trees to
predict the readability scores. First, we import and prepare data for
modeling. Then, we split the data into training and test pieces.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Import the dataset</span></span>
<span></span>
<span><span class='va'>readability</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span><span class='st'>'data/readability_features.csv'</span><span class='op'>)</span>,header<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Write the recipe</span></span>
<span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/recipes'>recipes</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>blueprint_readability</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://recipes.tidymodels.org/reference/recipe.html'>recipe</a></span><span class='op'>(</span>x     <span class='op'>=</span> <span class='va'>readability</span>,</span>
<span>                    vars  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>colnames</a></span><span class='op'>(</span><span class='va'>readability</span><span class='op'>)</span>,</span>
<span>                    roles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>'predictor'</span>,<span class='fl'>768</span><span class='op'>)</span>,<span class='st'>'outcome'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>             <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_zv.html'>step_zv</a></span><span class='op'>(</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_numeric</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>             <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_nzv.html'>step_nzv</a></span><span class='op'>(</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_numeric</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>             <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_normalize.html'>step_normalize</a></span><span class='op'>(</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_numeric_predictors</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span></span>
<span>             </span>
<span><span class='co'># Train/Test Split</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>10152021</span><span class='op'>)</span>  <span class='co'># for reproducibility</span></span>
<span>  </span>
<span><span class='va'>loc</span>      <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>readability</span><span class='op'>)</span>, <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>readability</span><span class='op'>)</span> <span class='op'>*</span> <span class='fl'>0.9</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>read_tr</span>  <span class='op'>&lt;-</span> <span class='va'>readability</span><span class='op'>[</span><span class='va'>loc</span>, <span class='op'>]</span></span>
<span><span class='va'>read_te</span>  <span class='op'>&lt;-</span> <span class='va'>readability</span><span class='op'>[</span><span class='op'>-</span><span class='va'>loc</span>, <span class='op'>]</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>read_tr</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>read_te</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>The code below will take a</p>
<ul>
<li><ol type="1">
<li>bootstrap sample from training data,</li>
</ol></li>
<li><ol start="2" type="1">
<li>develop a full tree model with no pruning, and</li>
</ol></li>
<li><ol start="3" type="1">
<li>save the model object as an element of a list.</li>
</ol></li>
</ul>
<p>We will repeat this process ten times.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/topepo/caret/'>caret</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>bag.models</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>'list'</span>,<span class='fl'>10</span><span class='op'>)</span></span>
<span></span>
<span><span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>{</span></span>
<span></span>
<span>  <span class='co'># Bootstrap sample</span></span>
<span>  </span>
<span>    <span class='va'>temp_rows</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>read_tr</span><span class='op'>)</span>,<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>read_tr</span><span class='op'>)</span>,replace<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span>  </span>
<span>    <span class='va'>temp</span> <span class='op'>&lt;-</span> <span class='va'>read_tr</span><span class='op'>[</span><span class='va'>temp_rows</span>,<span class='op'>]</span></span>
<span></span>
<span>  <span class='co'># Train the tree model with no pruning and no cross validation</span></span>
<span>    </span>
<span>    <span class='va'>grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>cp<span class='op'>=</span><span class='fl'>0</span><span class='op'>)</span></span>
<span>    <span class='va'>cv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"none"</span><span class='op'>)</span></span>
<span>        </span>
<span>    <span class='va'>bag.models</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>caret</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span><span class='va'>blueprint_readability</span>,</span>
<span>                                    data      <span class='op'>=</span> <span class='va'>temp</span>,</span>
<span>                                    method    <span class='op'>=</span> <span class='st'>'rpart'</span>,</span>
<span>                                    tuneGrid  <span class='op'>=</span> <span class='va'>grid</span>,</span>
<span>                                    trControl <span class='op'>=</span> <span class='va'>cv</span>,</span>
<span>                                    control   <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>minsplit<span class='op'>=</span><span class='fl'>20</span>,</span>
<span>                                                     minbucket <span class='op'>=</span> <span class='fl'>2</span>,</span>
<span>                                                     maxdepth <span class='op'>=</span> <span class='fl'>60</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='op'>}</span></span></code></pre>
</div>
</div>
<p>Now, we will use each of these models to predict the readability
score for the test data. We will also average these predictions. Then,
we will save the predictions in a matrix form to compare.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>preds</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>obs <span class='op'>=</span> <span class='va'>read_te</span><span class='op'>[</span>,<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'target'</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>preds</span><span class='op'>$</span><span class='va'>model1</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bag.models</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span><span class='va'>preds</span><span class='op'>$</span><span class='va'>model2</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bag.models</span><span class='op'>[[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span><span class='va'>preds</span><span class='op'>$</span><span class='va'>model3</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bag.models</span><span class='op'>[[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span><span class='va'>preds</span><span class='op'>$</span><span class='va'>model4</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bag.models</span><span class='op'>[[</span><span class='fl'>4</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span><span class='va'>preds</span><span class='op'>$</span><span class='va'>model5</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bag.models</span><span class='op'>[[</span><span class='fl'>5</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span><span class='va'>preds</span><span class='op'>$</span><span class='va'>model6</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bag.models</span><span class='op'>[[</span><span class='fl'>6</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span><span class='va'>preds</span><span class='op'>$</span><span class='va'>model7</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bag.models</span><span class='op'>[[</span><span class='fl'>7</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span><span class='va'>preds</span><span class='op'>$</span><span class='va'>model8</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bag.models</span><span class='op'>[[</span><span class='fl'>8</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span><span class='va'>preds</span><span class='op'>$</span><span class='va'>model9</span>  <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bag.models</span><span class='op'>[[</span><span class='fl'>9</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span><span class='va'>preds</span><span class='op'>$</span><span class='va'>model10</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bag.models</span><span class='op'>[[</span><span class='fl'>10</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>preds</span><span class='op'>$</span><span class='va'>average</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/Matrix/man/colSums.html'>rowMeans</a></span><span class='op'>(</span><span class='va'>preds</span><span class='op'>[</span>,<span class='fl'>2</span><span class='op'>:</span><span class='fl'>11</span><span class='op'>]</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>preds</span>,<span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>     obs model1 model2 model3 model4 model5 model6 model7 model8
1  0.246 -0.827  0.355  0.619 -0.925 -0.956  0.260 -0.095 -0.224
2 -0.188 -1.399 -0.963 -0.458  0.635 -0.415 -0.684 -0.101 -0.963
3 -0.135 -0.235  1.149  0.827  0.663  0.015  0.865  0.693 -0.013
4  0.395  0.690  0.355  1.361  0.025 -0.271  0.119 -0.406 -0.044
5 -0.371 -1.232 -0.901 -1.968 -1.147 -1.420 -1.393 -1.104  0.114
6 -1.156 -0.173 -0.531 -0.694 -1.390 -0.508 -0.690 -0.769  0.360
  model9 model10 average
1 -0.610   0.433  -0.197
2 -0.610   0.259  -0.470
3  0.242  -0.253   0.395
4  0.005   0.739   0.257
5 -1.024  -1.125  -1.120
6 -0.252  -0.894  -0.554</code></pre>
</div>
<p>Now, lets compute the RMSE for each models predicted scores and the
RMSE for the average of predicted scores from all ten tree models.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>p1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>obs</span> <span class='op'>-</span> <span class='va'>preds</span><span class='op'>$</span><span class='va'>model1</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>obs</span> <span class='op'>-</span> <span class='va'>preds</span><span class='op'>$</span><span class='va'>model2</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>obs</span> <span class='op'>-</span> <span class='va'>preds</span><span class='op'>$</span><span class='va'>model3</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>obs</span> <span class='op'>-</span> <span class='va'>preds</span><span class='op'>$</span><span class='va'>model4</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>obs</span> <span class='op'>-</span> <span class='va'>preds</span><span class='op'>$</span><span class='va'>model5</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p6</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>obs</span> <span class='op'>-</span> <span class='va'>preds</span><span class='op'>$</span><span class='va'>model6</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p7</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>obs</span> <span class='op'>-</span> <span class='va'>preds</span><span class='op'>$</span><span class='va'>model7</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p8</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>obs</span> <span class='op'>-</span> <span class='va'>preds</span><span class='op'>$</span><span class='va'>model8</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p9</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>obs</span> <span class='op'>-</span> <span class='va'>preds</span><span class='op'>$</span><span class='va'>model9</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>p10</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>obs</span> <span class='op'>-</span> <span class='va'>preds</span><span class='op'>$</span><span class='va'>model10</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>p.ave</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>preds</span><span class='op'>$</span><span class='va'>obs</span> <span class='op'>-</span> <span class='va'>preds</span><span class='op'>$</span><span class='va'>average</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>11</span>,y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>p1</span>,<span class='va'>p2</span>,<span class='va'>p3</span>,<span class='va'>p4</span>,<span class='va'>p5</span>,<span class='va'>p6</span>,<span class='va'>p7</span>,<span class='va'>p8</span>,<span class='va'>p9</span>,<span class='va'>p10</span>,<span class='va'>p.ave</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>'Model Predictions'</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>'RMSE'</span><span class='op'>)</span> <span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span> </span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>11</span>,</span>
<span>                     labels<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Model 1'</span>,<span class='st'>'Model 2'</span>, <span class='st'>'Model 3'</span>, <span class='st'>'Model 4'</span>, </span>
<span>                              <span class='st'>'Model 5'</span>,<span class='st'>'Model 6'</span>, <span class='st'>'Model 7'</span>, <span class='st'>'Model 8'</span>,</span>
<span>                              <span class='st'>'Model 9'</span>,<span class='st'>'Model 10'</span>,<span class='st'>'Bagged'</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/annotate.html'>annotate</a></span><span class='op'>(</span><span class='st'>'text'</span>,</span>
<span>           x <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>11</span>,</span>
<span>           y<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>p1</span>,<span class='va'>p2</span>,<span class='va'>p3</span>,<span class='va'>p4</span>,<span class='va'>p5</span>,<span class='va'>p6</span>,<span class='va'>p7</span>,<span class='va'>p8</span>,<span class='va'>p9</span>,<span class='va'>p10</span>,<span class='va'>p.ave</span><span class='op'>)</span><span class='op'>*</span><span class='fl'>1.03</span>,</span>
<span>           label <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>p1</span>,<span class='va'>p2</span>,<span class='va'>p3</span>,<span class='va'>p4</span>,<span class='va'>p5</span>,<span class='va'>p6</span>,<span class='va'>p7</span>,<span class='va'>p8</span>,<span class='va'>p9</span>,<span class='va'>p10</span>,<span class='va'>p.ave</span><span class='op'>)</span>,<span class='fl'>3</span><span class='op'>)</span>,</span>
<span>           cex<span class='op'>=</span><span class='fl'>3</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="lecture-7a_files/figure-html5/unnamed-chunk-7-1.png" width="624" style="display: block; margin: auto;" /></p>
</div>
<p>As it is evident, the bagging of 10 different tree models
significantly improved the predictions on the test dataset.</p>
<h2 id="bagging-with-the-ranger-and-carettrain-packages">1.2. BAGGING
with the <code>ranger</code> and <code>caret::train()</code>
packages</h2>
<p>Instead of writing your code to implement the idea of bagging for
decision trees, we can use the <code>ranger</code> method via
<code>caret::train()</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/imbs-hl/ranger'>ranger</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/modelLookup.html'>getModelInfo</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>$</span><span class='va'>ranger</span><span class='op'>$</span><span class='va'>parameters</span></span></code></pre>
</div>
<pre><code>      parameter     class                         label
1          mtry   numeric #Randomly Selected Predictors
2     splitrule character                Splitting Rule
3 min.node.size   numeric             Minimal Node Size</code></pre>
</div>
<p>The <code>caret::train()</code> allows us manipulate three parameters
while using the <code>ranger</code> method:</p>
<ul>
<li><p><em>splitrule</em>: set this to variance for regression
problems with continuous outcome. Other alternatives are
<code>extratrees</code>, <code>maxstat</code>, and
<code>beta</code>.</p></li>
<li><p><em>min.node.size.</em>: this is identical to
<code>minbucket</code> argument in the <code>rpart</code> method and
indicates the minimum number of observations for each node.</p></li>
<li><p><em>mtry</em>: this is the most critical parameter for this
method and indicates the number of predictors to consider for developing
tree models. For bagged decision trees, you can set this to the number
of all predictors in your model</p></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Cross validation settings </span></span>
<span>    </span>
<span>    <span class='va'>read_tr</span> <span class='op'>=</span> <span class='va'>read_tr</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>read_tr</span><span class='op'>)</span><span class='op'>)</span>,<span class='op'>]</span></span>
<span>  </span>
<span>    <span class='co'># Create 10 folds with equal size</span></span>
<span>    </span>
<span>    <span class='va'>folds</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>read_tr</span><span class='op'>)</span><span class='op'>)</span>,breaks<span class='op'>=</span><span class='fl'>10</span>,labels<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span></span>
<span>    </span>
<span>    <span class='co'># Create the list for each fold </span></span>
<span>    </span>
<span>    <span class='va'>my.indices</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>'list'</span>,<span class='fl'>10</span><span class='op'>)</span></span>
<span>    <span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>{</span></span>
<span>      <span class='va'>my.indices</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>folds</span><span class='op'>!=</span><span class='va'>i</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span></span>
<span>    </span>
<span>    <span class='va'>cv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,</span>
<span>                       index  <span class='op'>=</span> <span class='va'>my.indices</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Grid, running with all predictors in the data (768)</span></span>
<span></span>
<span><span class='va'>grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fl'>768</span>,splitrule<span class='op'>=</span><span class='st'>'variance'</span>,min.node.size<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='va'>grid</span></span></code></pre>
</div>
<pre><code>  mtry splitrule min.node.size
1  768  variance             2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Bagging with 10 tree models</span></span>
<span></span>
<span><span class='va'>bagged.trees</span> <span class='op'>&lt;-</span> <span class='fu'>caret</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span><span class='va'>blueprint_readability</span>,</span>
<span>                             data      <span class='op'>=</span> <span class='va'>read_tr</span>,</span>
<span>                             method    <span class='op'>=</span> <span class='st'>'ranger'</span>,</span>
<span>                             trControl <span class='op'>=</span> <span class='va'>cv</span>,</span>
<span>                             tuneGrid  <span class='op'>=</span> <span class='va'>grid</span>,</span>
<span>                             num.trees <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>                             max.depth <span class='op'>=</span> <span class='fl'>60</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>Lets check the cross-validated performance metrics.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>bagged.trees</span><span class='op'>$</span><span class='va'>results</span></span></code></pre>
</div>
<pre><code>  mtry splitrule min.node.size      RMSE  Rsquared      MAE
1  768  variance             2 0.6804536 0.5683141 0.543069
      RMSESD RsquaredSD      MAESD
1 0.02011178 0.02586802 0.01373682</code></pre>
</div>
<p>The performance is very similar to what we got in our DIY
demonstration.</p>
<p>A couple of things to note:</p>
<ul>
<li><p>When you set <code>max.depth=</code> argument within the
<code>caret::train</code> function, it passes this to the
<code>ranger</code> function. Try to set this number to as large as
possible, so you develop each tree to its full capacity.</p></li>
<li><p>The penalty term is technically zero (<code>cp</code> parameter
in the <code>rpart</code> function) while building each tree model. In
Bagging, we deal with the model variance differently. Instead of
applying a penalty term, we ensemble many unpenalized tree models to
reduce the model variance.</p></li>
<li><p>It is a little tricky to obtain reproducible results from this
procedure. See <a
href="https://github.com/topepo/caret/issues/1036">this link</a> to
learn more about accomplishing that.</p></li>
<li><p>The number of trees (bootstrap samples) is a hyperparameter to
tune. Conceptually, the model performance will improve as you increase
the number of tree models used in Bagging; however, the performance will
stabilize at some point. It is a tuning process to find the minimum
number of tree models in Bagging to obtain the maximal model
performance.</p></li>
</ul>
<h2 id="tuning-the-number-of-tree-models-in-bagging">1.3. Tuning the
Number of Tree Models in Bagging</h2>
<p>Unfortunately, <code>caret::train</code> does not let us define the
<code>num.trees</code> argument as a hyperparameter in the grid search.
So, the only way to search for the optimal number of trees is to use the
<code>ranger</code> method via <code>caret::train</code> function and
iterate over a set of values for the <code>num.trees</code> argument.
Then, compare the model performance and pick the optimal number of tree
models.</p>
<p>The code below implements this idea and saves the results from each
iteration in a list object.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Run the bagged trees by iterating over num.trees using the </span></span>
<span><span class='co'># values 5, 20, 40, 60,  ..., 200</span></span>
<span>  </span>
<span>  <span class='va'>nbags</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>,<span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span>from <span class='op'>=</span> <span class='fl'>20</span>,to <span class='op'>=</span> <span class='fl'>200</span>, by <span class='op'>=</span> <span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    </span>
<span>  <span class='va'>bags</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>'list'</span>,<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nbags</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    </span>
<span>    <span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nbags</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>      </span>
<span>      <span class='va'>bags</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>caret</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span><span class='va'>blueprint_readability</span>,</span>
<span>                                data      <span class='op'>=</span> <span class='va'>read_tr</span>,</span>
<span>                                method    <span class='op'>=</span> <span class='st'>'ranger'</span>,</span>
<span>                                trControl <span class='op'>=</span> <span class='va'>cv</span>,</span>
<span>                                tuneGrid  <span class='op'>=</span> <span class='va'>grid</span>,</span>
<span>                                num.trees <span class='op'>=</span> <span class='va'>nbags</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>,</span>
<span>                                max.depth <span class='op'>=</span> <span class='fl'>60</span><span class='op'>)</span></span>
<span>      </span>
<span>      <span class='fu'><a href='https://rdrr.io/r/base/print.html'>print</a></span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span></span>
<span>      </span>
<span>    <span class='op'>}</span></span>
<span></span>
<span>    <span class='co'># This can take a few hours to run.</span></span></code></pre>
</div>
</div>
<p>Lets check the cross-validated RMSE for the bagged tree models with
different number of trees.</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>rmses</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nbags</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>  </span>
<span>  <span class='va'>rmses</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>=</span> <span class='va'>bags</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>results</span><span class='op'>$</span><span class='va'>RMSE</span></span>
<span>  </span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>nbags</span>,y<span class='op'>=</span><span class='va'>rmses</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>'Number of Trees'</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>'RMSE'</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.6</span>,<span class='fl'>0.75</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<img src="lecture-7a_files/figure-html5/unnamed-chunk-13-1.png" width="624" style="display: block; margin: auto;" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>nbags</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.min</a></span><span class='op'>(</span><span class='va'>rmses</span><span class='op'>)</span><span class='op'>]</span></span></code></pre>
</div>
<pre><code>[1] 180</code></pre>
</div>
<p>It indicates that the RMSE stabilizes after roughly 60 tree models.
We can see that a bagged tree model with 180 trees gave the best result.
Lets see how well this model performs on the test data.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Predictions from a Bagged tree model with 180 trees</span></span>
<span></span>
<span><span class='va'>predicted_te</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bags</span><span class='op'>[[</span><span class='fl'>10</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># MAE</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>read_te</span><span class='op'>$</span><span class='va'>target</span> <span class='op'>-</span> <span class='va'>predicted_te</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.4776075</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># RMSE</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>read_te</span><span class='op'>$</span><span class='va'>target</span> <span class='op'>-</span> <span class='va'>predicted_te</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.6003086</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># R-square</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='va'>read_te</span><span class='op'>$</span><span class='va'>target</span>,<span class='va'>predicted_te</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span></span></code></pre>
</div>
<pre><code>[1] 0.6646118</code></pre>
</div>
<p>Now, we can add this to our comparison list to remember how well this
performs compared to other methods.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">R-square</th>
<th style="text-align: center;">MAE</th>
<th style="text-align: center;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Linear Regression</td>
<td style="text-align: center;">0.658</td>
<td style="text-align: center;">0.499</td>
<td style="text-align: center;">0.620</td>
</tr>
<tr class="even">
<td>Ridge Regression</td>
<td style="text-align: center;">0.727</td>
<td style="text-align: center;">0.432</td>
<td style="text-align: center;">0.536</td>
</tr>
<tr class="odd">
<td>Lasso Regression</td>
<td style="text-align: center;">0.721</td>
<td style="text-align: center;">0.433</td>
<td style="text-align: center;">0.542</td>
</tr>
<tr class="even">
<td>Elastic Net</td>
<td style="text-align: center;">0.726</td>
<td style="text-align: center;">0.433</td>
<td style="text-align: center;">0.539</td>
</tr>
<tr class="odd">
<td>KNN</td>
<td style="text-align: center;">0.611</td>
<td style="text-align: center;">0.519</td>
<td style="text-align: center;">0.648</td>
</tr>
<tr class="even">
<td>Decision Tree</td>
<td style="text-align: center;">0.499</td>
<td style="text-align: center;">0.574</td>
<td style="text-align: center;">0.724</td>
</tr>
<tr class="odd">
<td>Bagged Trees</td>
<td style="text-align: center;">0.664</td>
<td style="text-align: center;">0.478</td>
<td style="text-align: center;">0.600</td>
</tr>
</tbody>
</table>
<h1 id="random-forests">2. Random Forests</h1>
<p>Random Forests is an idea very similar to Bagging with an extra
feature. In Random Forests, while we take a bootstrap sample of
observations (a random sample of rows in training data with
replacement), we also take a random sample of columns for each split
while developing a tree model. It allows us to develop tree models more
independently of each other.</p>
<p>When specific important predictors are related to the outcome, the
tree models developed using all predictors will be very similar,
particularly at the top nodes, although we take bootstrap samples. These
trees will be correlated to each other, which may reduce the efficiency
of BAGGING in reducing the variance. We can diversify the tree models by
randomly sampling a certain number of predictors while developing each
tree. It turns out that a diverse group of tree models does much better
in predicting the outcome than a group of tree models similar to each
other.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="figs/randomforest.png" width="1122" style="display: block; margin: auto;" /></p>
</div>
<p>We can use the same <code>ranger</code> package to fit the random
forests models by only changing the <code>mtry</code> argument in our
grid. Below, we will fit a random forests model with ten trees by
randomly sampling from rows for each tree. In addition, when we develop
each tree model, we will also randomly sample 300 predictors. I set
<code>mtry=300</code> in the <code>grid</code> object, indicating that
it will randomly sample 300 predictors to consider for each split when
developing each tree.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Grid, randomly sample 300 predictors</span></span>
<span></span>
<span><span class='va'>grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fl'>300</span>,splitrule<span class='op'>=</span><span class='st'>'variance'</span>,min.node.size<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span><span class='va'>grid</span></span></code></pre>
</div>
<pre><code>  mtry splitrule min.node.size
1  300  variance             2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Random Forest with 10 tree models</span></span>
<span></span>
<span><span class='va'>rforest</span> <span class='op'>&lt;-</span> <span class='fu'>caret</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span><span class='va'>blueprint_readability</span>,</span>
<span>                        data      <span class='op'>=</span> <span class='va'>read_tr</span>,</span>
<span>                        method    <span class='op'>=</span> <span class='st'>'ranger'</span>,</span>
<span>                        trControl <span class='op'>=</span> <span class='va'>cv</span>,</span>
<span>                        tuneGrid  <span class='op'>=</span> <span class='va'>grid</span>,</span>
<span>                        num.trees <span class='op'>=</span> <span class='fl'>10</span>,</span>
<span>                        max.depth <span class='op'>=</span> <span class='fl'>60</span><span class='op'>)</span></span>
<span> </span>
<span><span class='va'>rforest</span><span class='op'>$</span><span class='va'>times</span></span></code></pre>
</div>
<pre><code>$everything
   user  system elapsed 
 177.76    1.08  133.97 

$final
   user  system elapsed 
  15.87    0.05   11.38 

$prediction
[1] NA NA NA</code></pre>
</div>
<p>Lets check the cross-validated performance metrics.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>rforest</span><span class='op'>$</span><span class='va'>results</span></span></code></pre>
</div>
<pre><code>  mtry splitrule min.node.size      RMSE  Rsquared       MAE
1  300  variance             2 0.6829234 0.5674509 0.5430574
      RMSESD RsquaredSD      MAESD
1 0.01628784 0.02833995 0.01213438</code></pre>
</div>
<p>For random forests, there are two hyperparameters to tune:</p>
<ul>
<li><p><code>mtry</code>, the number of predictors to choose for each
split during the tree model development</p></li>
<li><p><code>num.trees</code>, the number of trees.</p></li>
</ul>
<p>As mentioned before, unfortunately, the <code>caret::train</code>
only allows <code>mtry</code> in the grid search. For the number of
trees, one should embed it in a <code>for</code> loop to iterate over a
set of values. The code below hypothetically implements this idea by
trying ten different <code>mtry</code> values
(100,150,200,250,300,350,400,450,500,550) and saves the results from
each iteration in a list object. However, I havent run it, which may
take a long time.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Grid Settings  </span></span>
<span></span>
<span>    <span class='va'>grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>100</span>,<span class='fl'>150</span>,<span class='fl'>200</span>,<span class='fl'>250</span>,<span class='fl'>300</span>,<span class='fl'>350</span>,<span class='fl'>400</span>,<span class='fl'>450</span>,<span class='fl'>500</span>,<span class='fl'>550</span><span class='op'>)</span>,</span>
<span>                        splitrule<span class='op'>=</span><span class='st'>'variance'</span>,</span>
<span>                        min.node.size<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Run the bagged trees by iterating over num.trees values from 1 to 200</span></span>
<span>  </span>
<span>    <span class='va'>bags</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>'list'</span>,<span class='fl'>200</span><span class='op'>)</span></span>
<span>    </span>
<span>    <span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>200</span><span class='op'>)</span><span class='op'>{</span></span>
<span>      </span>
<span>      <span class='va'>bags</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>caret</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span><span class='va'>blueprint_readability</span>,</span>
<span>                                data      <span class='op'>=</span> <span class='va'>read_tr</span>,</span>
<span>                                method    <span class='op'>=</span> <span class='st'>'ranger'</span>,</span>
<span>                                trControl <span class='op'>=</span> <span class='va'>cv</span>,</span>
<span>                                tuneGrid  <span class='op'>=</span> <span class='va'>grid</span>,</span>
<span>                                num.trees <span class='op'>=</span> <span class='va'>i</span>,</span>
<span>                                max.depth <span class='op'>=</span> <span class='fl'>60</span>,<span class='op'>)</span></span>
<span>      </span>
<span>    <span class='op'>}</span></span></code></pre>
</div>
</div>
<p>Instead, I run this by fixing <code>mtry=300</code> and then
iterating over the number of trees for values of 5, 20, 40, 60, 80, ,
200 (as we did for bagged trees).</p>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>rmses</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nbags</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>  </span>
<span>  <span class='va'>rmses</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>=</span> <span class='va'>bags</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>results</span><span class='op'>$</span><span class='va'>RMSE</span></span>
<span>  </span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>nbags</span>,y<span class='op'>=</span><span class='va'>rmses</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>'Number of Trees'</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>'RMSE'</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.6</span>,<span class='fl'>0.75</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<img src="lecture-7a_files/figure-html5/unnamed-chunk-20-1.png" width="624" style="display: block; margin: auto;" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>nbags</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.min</a></span><span class='op'>(</span><span class='va'>rmses</span><span class='op'>)</span><span class='op'>]</span></span></code></pre>
</div>
<pre><code>[1] 160</code></pre>
</div>
<p>RMSE similarly stabilized after roughly 60 trees. Lets see how well
the model with 200 trees perform.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Predictions from a Random Forest model with 160 trees</span></span>
<span></span>
<span><span class='va'>predicted_te</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bags</span><span class='op'>[[</span><span class='fl'>11</span><span class='op'>]</span><span class='op'>]</span>,<span class='va'>read_te</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># MAE</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>read_te</span><span class='op'>$</span><span class='va'>target</span> <span class='op'>-</span> <span class='va'>predicted_te</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.4756419</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># RMSE</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>read_te</span><span class='op'>$</span><span class='va'>target</span> <span class='op'>-</span> <span class='va'>predicted_te</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.6003527</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># R-square</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/stats/cor.html'>cor</a></span><span class='op'>(</span><span class='va'>read_te</span><span class='op'>$</span><span class='va'>target</span>,<span class='va'>predicted_te</span><span class='op'>)</span><span class='op'>^</span><span class='fl'>2</span></span></code></pre>
</div>
<pre><code>[1] 0.6690829</code></pre>
</div>
<p>Below is our comparison table with Random Forests added. As you see,
there is a slight improvement over Bagged Trees, and we can improve this
a little more by trying different values of <code>mtry</code> and
finding an optimal number.</p>
<table>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">R-square</th>
<th style="text-align: center;">MAE</th>
<th style="text-align: center;">RMSE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Linear Regression</td>
<td style="text-align: center;">0.658</td>
<td style="text-align: center;">0.499</td>
<td style="text-align: center;">0.620</td>
</tr>
<tr class="even">
<td>Ridge Regression</td>
<td style="text-align: center;">0.727</td>
<td style="text-align: center;">0.432</td>
<td style="text-align: center;">0.536</td>
</tr>
<tr class="odd">
<td>Lasso Regression</td>
<td style="text-align: center;">0.721</td>
<td style="text-align: center;">0.433</td>
<td style="text-align: center;">0.542</td>
</tr>
<tr class="even">
<td>Elastic Net</td>
<td style="text-align: center;">0.726</td>
<td style="text-align: center;">0.433</td>
<td style="text-align: center;">0.539</td>
</tr>
<tr class="odd">
<td>KNN</td>
<td style="text-align: center;">0.611</td>
<td style="text-align: center;">0.519</td>
<td style="text-align: center;">0.648</td>
</tr>
<tr class="even">
<td>Decision Tree</td>
<td style="text-align: center;">0.499</td>
<td style="text-align: center;">0.574</td>
<td style="text-align: center;">0.724</td>
</tr>
<tr class="odd">
<td>Bagged Trees</td>
<td style="text-align: center;">0.664</td>
<td style="text-align: center;">0.478</td>
<td style="text-align: center;">0.600</td>
</tr>
<tr class="even">
<td>Random Forests</td>
<td style="text-align: center;">0.669</td>
<td style="text-align: center;">0.476</td>
<td style="text-align: center;">0.600</td>
</tr>
</tbody>
</table>
<h1 id="predicting-recidivism-using-bagges-trees-and-random-forests">3.
Predicting Recidivism using Bagges Trees and Random Forests</h1>
<p>In this section, I provide the R code to predict recidivism using
Bagged Trees and Random Forests.</p>
<p><strong>Import the recidivism dataset and pre-process the
variables</strong></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Import data</span></span>
<span></span>
<span><span class='va'>recidivism</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/utils/read.table.html'>read.csv</a></span><span class='op'>(</span><span class='st'>'./data/recidivism_y1 removed and recoded.csv'</span>,header<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Write the recipe</span></span>
<span></span>
<span>  <span class='co'># List of variable types </span></span>
<span>  </span>
<span>  <span class='va'>outcome</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Recidivism_Arrest_Year2'</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>id</span>      <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'ID'</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>categorical</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Residence_PUMA'</span>,</span>
<span>                   <span class='st'>'Prison_Offense'</span>,</span>
<span>                   <span class='st'>'Age_at_Release'</span>,</span>
<span>                   <span class='st'>'Supervision_Level_First'</span>,</span>
<span>                   <span class='st'>'Education_Level'</span>,</span>
<span>                   <span class='st'>'Prison_Years'</span>,</span>
<span>                   <span class='st'>'Gender'</span>,</span>
<span>                   <span class='st'>'Race'</span>,</span>
<span>                   <span class='st'>'Gang_Affiliated'</span>,</span>
<span>                   <span class='st'>'Prior_Arrest_Episodes_DVCharges'</span>,</span>
<span>                   <span class='st'>'Prior_Arrest_Episodes_GunCharges'</span>,</span>
<span>                   <span class='st'>'Prior_Conviction_Episodes_Viol'</span>,</span>
<span>                   <span class='st'>'Prior_Conviction_Episodes_PPViolationCharges'</span>,</span>
<span>                   <span class='st'>'Prior_Conviction_Episodes_DomesticViolenceCharges'</span>,</span>
<span>                   <span class='st'>'Prior_Conviction_Episodes_GunCharges'</span>,</span>
<span>                   <span class='st'>'Prior_Revocations_Parole'</span>,</span>
<span>                   <span class='st'>'Prior_Revocations_Probation'</span>,</span>
<span>                   <span class='st'>'Condition_MH_SA'</span>,</span>
<span>                   <span class='st'>'Condition_Cog_Ed'</span>,</span>
<span>                   <span class='st'>'Condition_Other'</span>,</span>
<span>                   <span class='st'>'Violations_ElectronicMonitoring'</span>,</span>
<span>                   <span class='st'>'Violations_Instruction'</span>,</span>
<span>                   <span class='st'>'Violations_FailToReport'</span>,</span>
<span>                   <span class='st'>'Violations_MoveWithoutPermission'</span>,</span>
<span>                   <span class='st'>'Employment_Exempt'</span><span class='op'>)</span> </span>
<span></span>
<span>  <span class='va'>numeric</span>   <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Supervision_Risk_Score_First'</span>,</span>
<span>                 <span class='st'>'Dependents'</span>,</span>
<span>                 <span class='st'>'Prior_Arrest_Episodes_Felony'</span>,</span>
<span>                 <span class='st'>'Prior_Arrest_Episodes_Misd'</span>,</span>
<span>                 <span class='st'>'Prior_Arrest_Episodes_Violent'</span>,</span>
<span>                 <span class='st'>'Prior_Arrest_Episodes_Property'</span>,</span>
<span>                 <span class='st'>'Prior_Arrest_Episodes_Drug'</span>,</span>
<span>                 <span class='st'>'Prior_Arrest_Episodes_PPViolationCharges'</span>,</span>
<span>                 <span class='st'>'Prior_Conviction_Episodes_Felony'</span>,</span>
<span>                 <span class='st'>'Prior_Conviction_Episodes_Misd'</span>,</span>
<span>                 <span class='st'>'Prior_Conviction_Episodes_Prop'</span>,</span>
<span>                 <span class='st'>'Prior_Conviction_Episodes_Drug'</span>,</span>
<span>                 <span class='st'>'Delinquency_Reports'</span>,</span>
<span>                 <span class='st'>'Program_Attendances'</span>,</span>
<span>                 <span class='st'>'Program_UnexcusedAbsences'</span>,</span>
<span>                 <span class='st'>'Residence_Changes'</span>,</span>
<span>                 <span class='st'>'Avg_Days_per_DrugTest'</span>,</span>
<span>                 <span class='st'>'Jobs_Per_Year'</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>props</span>      <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'DrugTests_THC_Positive'</span>,</span>
<span>                  <span class='st'>'DrugTests_Cocaine_Positive'</span>,</span>
<span>                  <span class='st'>'DrugTests_Meth_Positive'</span>,</span>
<span>                  <span class='st'>'DrugTests_Other_Positive'</span>,</span>
<span>                  <span class='st'>'Percent_Days_Employed'</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Convert all nominal, ordinal, and binary variables to factors</span></span>
<span>  </span>
<span>  <span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='va'>categorical</span><span class='op'>)</span><span class='op'>{</span></span>
<span>    </span>
<span>    <span class='va'>recidivism</span><span class='op'>[</span>,<span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>as.factor</a></span><span class='op'>(</span><span class='va'>recidivism</span><span class='op'>[</span>,<span class='va'>i</span><span class='op'>]</span><span class='op'>)</span></span>
<span>    </span>
<span>  <span class='op'>}</span></span>
<span></span>
<span>  <span class='co'># Blueprint for processing variables</span></span>
<span>      </span>
<span>  <span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/tidymodels/recipes'>recipes</a></span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>blueprint_recidivism</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://recipes.tidymodels.org/reference/recipe.html'>recipe</a></span><span class='op'>(</span>x  <span class='op'>=</span> <span class='va'>recidivism</span>,</span>
<span>                      vars  <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>categorical</span>,<span class='va'>numeric</span>,<span class='va'>props</span>,<span class='va'>outcome</span>,<span class='va'>id</span><span class='op'>)</span>,</span>
<span>                      roles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>'predictor'</span>,<span class='fl'>48</span><span class='op'>)</span>,<span class='st'>'outcome'</span>,<span class='st'>'ID'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_indicate_na.html'>step_indicate_na</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>categorical</span><span class='op'>)</span>,<span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>numeric</span><span class='op'>)</span>,<span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>props</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_zv.html'>step_zv</a></span><span class='op'>(</span><span class='fu'><a href='https://recipes.tidymodels.org/reference/has_role.html'>all_numeric</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_impute_mean.html'>step_impute_mean</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>numeric</span><span class='op'>)</span>,<span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>props</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_impute_mode.html'>step_impute_mode</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>categorical</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_logit.html'>step_logit</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>props</span><span class='op'>)</span>,offset<span class='op'>=</span><span class='fl'>.001</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_poly.html'>step_poly</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>numeric</span><span class='op'>)</span>,<span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>props</span><span class='op'>)</span>,degree<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_normalize.html'>step_normalize</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>numeric</span>,<span class='st'>'_poly_1'</span><span class='op'>)</span>,</span>
<span>                   <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>numeric</span>,<span class='st'>'_poly_2'</span><span class='op'>)</span>,</span>
<span>                   <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>props</span>,<span class='st'>'_poly_1'</span><span class='op'>)</span>,</span>
<span>                   <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>props</span>,<span class='st'>'_poly_2'</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_dummy.html'>step_dummy</a></span><span class='op'>(</span><span class='fu'><a href='https://tidyselect.r-lib.org/reference/all_of.html'>all_of</a></span><span class='op'>(</span><span class='va'>categorical</span><span class='op'>)</span>,one_hot<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>    <span class='fu'><a href='https://recipes.tidymodels.org/reference/step_num2factor.html'>step_num2factor</a></span><span class='op'>(</span><span class='va'>Recidivism_Arrest_Year2</span>,</span>
<span>                    transform <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span> <span class='va'>x</span> <span class='op'>+</span> <span class='fl'>1</span>,</span>
<span>                    levels<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'No'</span>,<span class='st'>'Yes'</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='va'>blueprint_recidivism</span></span></code></pre>
</div>
</div>
<p><strong>2. Train/Test Split</strong></p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span>  <span class='va'>loc</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>recidivism</span><span class='op'>$</span><span class='va'>Training_Sample</span><span class='op'>==</span><span class='fl'>1</span><span class='op'>)</span></span>
<span></span>
<span>  <span class='co'># Training dataset</span></span>
<span></span>
<span>  <span class='va'>recidivism_tr</span>  <span class='op'>&lt;-</span> <span class='va'>recidivism</span><span class='op'>[</span><span class='va'>loc</span>, <span class='op'>]</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>recidivism_tr</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Test dataset</span></span>
<span></span>
<span>  <span class='va'>recidivism_te</span>  <span class='op'>&lt;-</span> <span class='va'>recidivism</span><span class='op'>[</span><span class='op'>-</span><span class='va'>loc</span>, <span class='op'>]</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>recidivism_te</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<h2 id="bagged-trees">3.1. Bagged Trees</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Cross validation settings </span></span>
<span>    </span>
<span>    <span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>10302021</span><span class='op'>)</span> <span class='co'># for reproducibility</span></span>
<span>    </span>
<span>    <span class='va'>recidivism_tr</span> <span class='op'>=</span> <span class='va'>recidivism_tr</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/sample.html'>sample</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>recidivism_tr</span><span class='op'>)</span><span class='op'>)</span>,<span class='op'>]</span></span>
<span>  </span>
<span>  <span class='co'># Create 10 folds with equal size</span></span>
<span>  </span>
<span>    <span class='va'>folds</span> <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>recidivism_tr</span><span class='op'>)</span><span class='op'>)</span>,breaks<span class='op'>=</span><span class='fl'>10</span>,labels<span class='op'>=</span><span class='cn'>FALSE</span><span class='op'>)</span></span>
<span>  </span>
<span>  <span class='co'># Create the list for each fold </span></span>
<span>  </span>
<span>    <span class='va'>my.indices</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>'list'</span>,<span class='fl'>10</span><span class='op'>)</span></span>
<span>    <span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>10</span><span class='op'>)</span><span class='op'>{</span></span>
<span>      <span class='va'>my.indices</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/which.html'>which</a></span><span class='op'>(</span><span class='va'>folds</span><span class='op'>!=</span><span class='va'>i</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span></span>
<span>    </span>
<span>      </span>
<span>  <span class='va'>cv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/caret/man/trainControl.html'>trainControl</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"cv"</span>,</span>
<span>                     index  <span class='op'>=</span> <span class='va'>my.indices</span>,</span>
<span>                     classProbs <span class='op'>=</span> <span class='cn'>TRUE</span>,</span>
<span>                     summaryFunction <span class='op'>=</span> <span class='va'>mnLogLoss</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Grid settings</span></span>
<span></span>
<span>  <span class='co'># Notice that I use **'gini'** for splitrule because this is </span></span>
<span>  <span class='co'># now a classification problem.</span></span>
<span>  </span>
<span>  <span class='va'>grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fl'>142</span>,</span>
<span>                    splitrule<span class='op'>=</span><span class='st'>'gini'</span>,</span>
<span>                    min.node.size<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span>  <span class='va'>grid</span></span>
<span></span>
<span><span class='co'># Run the BAGGED Trees with different number of trees </span></span>
<span><span class='co'># 5, 20, 40, 60, ..., 200</span></span>
<span>  </span>
<span>    <span class='va'>nbags</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>,<span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>20</span>,<span class='fl'>200</span>,<span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span></span>
<span>    </span>
<span>    <span class='va'>bags</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>'list'</span>,<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nbags</span><span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span>    <span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nbags</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>      </span>
<span>      <span class='va'>bags</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>caret</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span><span class='va'>blueprint_recidivism</span>,</span>
<span>                                data      <span class='op'>=</span> <span class='va'>recidivism_tr</span>,</span>
<span>                                method    <span class='op'>=</span> <span class='st'>'ranger'</span>,</span>
<span>                                trControl <span class='op'>=</span> <span class='va'>cv</span>,</span>
<span>                                tuneGrid  <span class='op'>=</span> <span class='va'>grid</span>,</span>
<span>                                metric    <span class='op'>=</span> <span class='st'>'logLoss'</span>,</span>
<span>                                num.trees <span class='op'>=</span> <span class='va'>nbags</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>,</span>
<span>                                max.depth <span class='op'>=</span> <span class='fl'>60</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>logLoss_</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nbags</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>  </span>
<span>  <span class='va'>logLoss_</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>=</span> <span class='va'>bags</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>results</span><span class='op'>$</span><span class='va'>logLoss</span></span>
<span>  </span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>nbags</span>,y<span class='op'>=</span><span class='va'>logLoss_</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>'Number ofs'</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>'Negative LogLoss'</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.4</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<img src="lecture-7a_files/figure-html5/unnamed-chunk-26-1.png" width="624" style="display: block; margin: auto;" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>nbags</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.min</a></span><span class='op'>(</span><span class='va'>logLoss_</span><span class='op'>)</span><span class='op'>]</span></span></code></pre>
</div>
<pre><code>[1] 200</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Predict the probabilities for the observations in the test dataset</span></span>
<span></span>
<span><span class='va'>predicted_te</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bags</span><span class='op'>[[</span><span class='fl'>11</span><span class='op'>]</span><span class='op'>]</span>, <span class='va'>recidivism_te</span>, type<span class='op'>=</span><span class='st'>'prob'</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/r/base/dim.html'>dim</a></span><span class='op'>(</span><span class='va'>predicted_te</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 5460    2</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>predicted_te</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>      No    Yes
1 0.9900 0.0100
2 0.6050 0.3950
3 0.6150 0.3850
4 0.5675 0.4325
5 0.7725 0.2275
6 0.6900 0.3100</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Compute the AUC</span></span>
<span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>require</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/thie1e/cutpointr'>cutpointr</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>cut.obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/cutpointr/man/cutpointr.html'>cutpointr</a></span><span class='op'>(</span>x     <span class='op'>=</span> <span class='va'>predicted_te</span><span class='op'>$</span><span class='va'>Yes</span>,</span>
<span>                     class <span class='op'>=</span> <span class='va'>recidivism_te</span><span class='op'>$</span><span class='va'>Recidivism_Arrest_Year2</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/cutpointr/man/auc.html'>auc</a></span><span class='op'>(</span><span class='va'>cut.obj</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.7241845</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Confusion matrix assuming the threshold is 0.5</span></span>
<span></span>
<span><span class='va'>pred_class</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>predicted_te</span><span class='op'>$</span><span class='va'>Yes</span><span class='op'>&gt;</span><span class='fl'>.5</span>,<span class='fl'>1</span>,<span class='fl'>0</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>confusion</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>recidivism_te</span><span class='op'>$</span><span class='va'>Recidivism_Arrest_Year2</span>,<span class='va'>pred_class</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>confusion</span></span></code></pre>
</div>
<pre><code>   pred_class
       0    1
  0 3957  189
  1 1125  189</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># True Negative Rate</span></span>
<span></span>
<span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>/</span><span class='op'>(</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>+</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.9544139</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># False Positive Rate</span></span>
<span></span>
<span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>/</span><span class='op'>(</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>+</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.04558611</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># True Positive Rate</span></span>
<span></span>
<span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>/</span><span class='op'>(</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>+</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.1438356</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Precision</span></span>
<span></span>
<span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>/</span><span class='op'>(</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>+</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.5</code></pre>
</div>
<table style="width:100%;">
<colgroup>
<col style="width: 53%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">-LL</th>
<th style="text-align: center;">AUC</th>
<th style="text-align: center;">ACC</th>
<th style="text-align: center;">TPR</th>
<th style="text-align: center;">TNR</th>
<th style="text-align: center;">FPR</th>
<th style="text-align: center;">PRE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Bagged Trees</td>
<td style="text-align: center;">0.506</td>
<td style="text-align: center;">0.724</td>
<td style="text-align: center;">0.759</td>
<td style="text-align: center;">0.144</td>
<td style="text-align: center;">0.954</td>
<td style="text-align: center;">0.046</td>
<td style="text-align: center;">0.500</td>
</tr>
<tr class="even">
<td>Logistic Regression</td>
<td style="text-align: center;">0.510</td>
<td style="text-align: center;">0.719</td>
<td style="text-align: center;">0.755</td>
<td style="text-align: center;">0.142</td>
<td style="text-align: center;">0.949</td>
<td style="text-align: center;">0.051</td>
<td style="text-align: center;">0.471</td>
</tr>
<tr class="odd">
<td>Logistic Regression with Ridge Penalty</td>
<td style="text-align: center;">0.511</td>
<td style="text-align: center;">0.718</td>
<td style="text-align: center;">0.754</td>
<td style="text-align: center;">0.123</td>
<td style="text-align: center;">0.954</td>
<td style="text-align: center;">0.046</td>
<td style="text-align: center;">0.461</td>
</tr>
<tr class="even">
<td>Logistic Regression with Lasso Penalty</td>
<td style="text-align: center;">0.509</td>
<td style="text-align: center;">0.720</td>
<td style="text-align: center;">0.754</td>
<td style="text-align: center;">0.127</td>
<td style="text-align: center;">0.952</td>
<td style="text-align: center;">0.048</td>
<td style="text-align: center;">0.458</td>
</tr>
<tr class="odd">
<td>Logistic Regression with Elastic Net</td>
<td style="text-align: center;">0.509</td>
<td style="text-align: center;">0.720</td>
<td style="text-align: center;">0.753</td>
<td style="text-align: center;">0.127</td>
<td style="text-align: center;">0.952</td>
<td style="text-align: center;">0.048</td>
<td style="text-align: center;">0.456</td>
</tr>
<tr class="even">
<td>KNN</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
</tr>
<tr class="odd">
<td>Decision Tree</td>
<td style="text-align: center;">0.558</td>
<td style="text-align: center;">0.603</td>
<td style="text-align: center;">0.757</td>
<td style="text-align: center;">0.031</td>
<td style="text-align: center;">0.986</td>
<td style="text-align: center;">0.014</td>
<td style="text-align: center;">0.423</td>
</tr>
</tbody>
</table>
<h2 id="random-forests-1">3.2. Random Forests</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Grid settings</span></span>
<span></span>
<span><span class='va'>grid</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>mtry <span class='op'>=</span> <span class='fl'>80</span>,splitrule<span class='op'>=</span><span class='st'>'gini'</span>,min.node.size<span class='op'>=</span><span class='fl'>2</span><span class='op'>)</span></span>
<span></span>
<span>    <span class='co'># The only difference for random forests is that I set mtry = 80</span></span>
<span></span>
<span><span class='co'># Run the Random Forests with different number of trees </span></span>
<span><span class='co'># 5, 20, 40, 60, ..., 200</span></span>
<span>  </span>
<span>   <span class='va'>nbags</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>,<span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>20</span>,<span class='fl'>200</span>,<span class='fl'>20</span><span class='op'>)</span><span class='op'>)</span></span>
<span>   <span class='va'>bags</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span><span class='st'>'list'</span>,<span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nbags</span><span class='op'>)</span><span class='op'>)</span></span>
<span>  </span>
<span>    <span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nbags</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>      </span>
<span>      <span class='va'>bags</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'>caret</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/caret/man/train.html'>train</a></span><span class='op'>(</span><span class='va'>blueprint_recidivism</span>,</span>
<span>                                data      <span class='op'>=</span> <span class='va'>recidivism_tr</span>,</span>
<span>                                method    <span class='op'>=</span> <span class='st'>'ranger'</span>,</span>
<span>                                trControl <span class='op'>=</span> <span class='va'>cv</span>,</span>
<span>                                tuneGrid  <span class='op'>=</span> <span class='va'>grid</span>,</span>
<span>                                metric    <span class='op'>=</span> <span class='st'>'logLoss'</span>,</span>
<span>                                num.trees <span class='op'>=</span> <span class='va'>nbags</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span>,</span>
<span>                                max.depth <span class='op'>=</span> <span class='fl'>60</span><span class='op'>)</span></span>
<span>    <span class='op'>}</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">

</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>logLoss_</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>)</span></span>
<span></span>
<span><span class='kw'>for</span><span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>nbags</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span></span>
<span>  </span>
<span>  <span class='va'>logLoss_</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>=</span> <span class='va'>bags</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>$</span><span class='va'>results</span><span class='op'>$</span><span class='va'>logLoss</span></span>
<span>  </span>
<span><span class='op'>}</span></span>
<span></span>
<span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_path.html'>geom_line</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x<span class='op'>=</span><span class='va'>nbags</span>,y<span class='op'>=</span><span class='va'>logLoss_</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>xlab</a></span><span class='op'>(</span><span class='st'>'Number ofs'</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>ylab</a></span><span class='op'>(</span><span class='st'>'Negative LogLoss'</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/lims.html'>ylim</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.4</span>,<span class='fl'>2</span><span class='op'>)</span><span class='op'>)</span><span class='op'>+</span></span>
<span>  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span><span class='op'>)</span></span></code></pre>
</div>
<img src="lecture-7a_files/figure-html5/unnamed-chunk-30-1.png" width="624" style="display: block; margin: auto;" />
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>nbags</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/which.min.html'>which.min</a></span><span class='op'>(</span><span class='va'>logLoss_</span><span class='op'>)</span><span class='op'>]</span></span></code></pre>
</div>
<pre><code>[1] 180</code></pre>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Predict the probabilities for the observations in the test dataset</span></span>
<span></span>
<span><span class='va'>predicted_te</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>bags</span><span class='op'>[[</span><span class='fl'>10</span><span class='op'>]</span><span class='op'>]</span>, <span class='va'>recidivism_te</span>, type<span class='op'>=</span><span class='st'>'prob'</span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Compute the AUC</span></span>
<span></span>
<span><span class='va'>cut.obj</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/cutpointr/man/cutpointr.html'>cutpointr</a></span><span class='op'>(</span>x     <span class='op'>=</span> <span class='va'>predicted_te</span><span class='op'>$</span><span class='va'>Yes</span>,</span>
<span>                     class <span class='op'>=</span> <span class='va'>recidivism_te</span><span class='op'>$</span><span class='va'>Recidivism_Arrest_Year2</span><span class='op'>)</span></span>
<span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/cutpointr/man/auc.html'>auc</a></span><span class='op'>(</span><span class='va'>cut.obj</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.7251904</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Confusion matrix assuming the threshold is 0.5</span></span>
<span></span>
<span><span class='va'>pred_class</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>predicted_te</span><span class='op'>$</span><span class='va'>Yes</span><span class='op'>&gt;</span><span class='fl'>.5</span>,<span class='fl'>1</span>,<span class='fl'>0</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>confusion</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/table.html'>table</a></span><span class='op'>(</span><span class='va'>recidivism_te</span><span class='op'>$</span><span class='va'>Recidivism_Arrest_Year2</span>,<span class='va'>pred_class</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>confusion</span></span></code></pre>
</div>
<pre><code>   pred_class
       0    1
  0 3956  190
  1 1113  201</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># True Negative Rate</span></span>
<span></span>
<span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>/</span><span class='op'>(</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>+</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.9541727</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># False Positive Rate</span></span>
<span></span>
<span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>/</span><span class='op'>(</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>+</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.0458273</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># True Positive Rate</span></span>
<span></span>
<span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>/</span><span class='op'>(</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>+</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.152968</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Precision</span></span>
<span></span>
<span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>/</span><span class='op'>(</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>1</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>+</span><span class='va'>confusion</span><span class='op'>[</span><span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>[1] 0.5140665</code></pre>
</div>
<table style="width:100%;">
<colgroup>
<col style="width: 53%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
<col style="width: 6%" />
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: center;">-LL</th>
<th style="text-align: center;">AUC</th>
<th style="text-align: center;">ACC</th>
<th style="text-align: center;">TPR</th>
<th style="text-align: center;">TNR</th>
<th style="text-align: center;">FPR</th>
<th style="text-align: center;">PRE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Random Forests</td>
<td style="text-align: center;">0.507</td>
<td style="text-align: center;">0.725</td>
<td style="text-align: center;">0.761</td>
<td style="text-align: center;">0.153</td>
<td style="text-align: center;">0.954</td>
<td style="text-align: center;">0.046</td>
<td style="text-align: center;">0.514</td>
</tr>
<tr class="even">
<td>Bagged Trees</td>
<td style="text-align: center;">0.506</td>
<td style="text-align: center;">0.724</td>
<td style="text-align: center;">0.759</td>
<td style="text-align: center;">0.144</td>
<td style="text-align: center;">0.954</td>
<td style="text-align: center;">0.046</td>
<td style="text-align: center;">0.500</td>
</tr>
<tr class="odd">
<td>Logistic Regression</td>
<td style="text-align: center;">0.510</td>
<td style="text-align: center;">0.719</td>
<td style="text-align: center;">0.755</td>
<td style="text-align: center;">0.142</td>
<td style="text-align: center;">0.949</td>
<td style="text-align: center;">0.051</td>
<td style="text-align: center;">0.471</td>
</tr>
<tr class="even">
<td>Logistic Regression with Ridge Penalty</td>
<td style="text-align: center;">0.511</td>
<td style="text-align: center;">0.718</td>
<td style="text-align: center;">0.754</td>
<td style="text-align: center;">0.123</td>
<td style="text-align: center;">0.954</td>
<td style="text-align: center;">0.046</td>
<td style="text-align: center;">0.461</td>
</tr>
<tr class="odd">
<td>Logistic Regression with Lasso Penalty</td>
<td style="text-align: center;">0.509</td>
<td style="text-align: center;">0.720</td>
<td style="text-align: center;">0.754</td>
<td style="text-align: center;">0.127</td>
<td style="text-align: center;">0.952</td>
<td style="text-align: center;">0.048</td>
<td style="text-align: center;">0.458</td>
</tr>
<tr class="even">
<td>Logistic Regression with Elastic Net</td>
<td style="text-align: center;">0.509</td>
<td style="text-align: center;">0.720</td>
<td style="text-align: center;">0.753</td>
<td style="text-align: center;">0.127</td>
<td style="text-align: center;">0.952</td>
<td style="text-align: center;">0.048</td>
<td style="text-align: center;">0.456</td>
</tr>
<tr class="odd">
<td>KNN</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
<td style="text-align: center;">?</td>
</tr>
<tr class="even">
<td>Decision Tree</td>
<td style="text-align: center;">0.558</td>
<td style="text-align: center;">0.603</td>
<td style="text-align: center;">0.757</td>
<td style="text-align: center;">0.031</td>
<td style="text-align: center;">0.986</td>
<td style="text-align: center;">0.014</td>
<td style="text-align: center;">0.423</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb38"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
<h3 id="reuse">Reuse</h3>
<p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<div class="distill-site-nav distill-site-footer">
<center>
<p> Cengiz Zopluoglu, cengiz@uoregon.edu </p>
<p> Made using <a href="https://rstudio.github.io/distill/website.html"> the Distill for R Markdown</a> in 
<a href = "https://www.rstudio.com"> RStudio.</a></p>
<p>Copyright &copy; 2022 Cengiz Zopluoglu. All rights reserved.</p>
</center>
</div>
<!--/radix_placeholder_navigation_after_body-->


</body>

</html>
